<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GCSE Daily Planner + Pomodoro</title>
  <style>
    :root{
      --bg:#ffffff; --fg:#0f172a; --muted:#eaeef6; --ink:#111827; --accent:#2563eb; --good:#16a34a; --warn:#f59e0b; --danger:#ef4444;
      --shadow:0 10px 30px rgba(15,23,42,.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.5 system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif;}
    .wrap{min-height:100%;display:flex;flex-direction:column;}
    header{padding:20px 16px;border-bottom:1px solid #e5e7eb}
    .container{max-width:960px;margin:0 auto;padding:0 16px}
    .title{font-weight:800;font-size:clamp(20px,2.4vw,30px)}
    .subtitle{opacity:.75}

    /* Centered main card */
    .main{flex:1;display:flex;align-items:center;justify-content:center;padding:24px}
    .card{width:100%;max-width:760px;background:#fff;border:1px solid #e5e7eb;border-radius:18px;box-shadow:var(--shadow);padding:22px}

    .todayLine{font-size:18px;margin:0 0 8px 0}
    .plan{opacity:.85;margin:0 14px 18px 0}

    .list{padding:0;margin:0;list-style:none;display:flex;flex-wrap:wrap;gap:8px}
    .pill{background:#f3f4f6;border:1px solid #e5e7eb;border-radius:999px;padding:6px 10px;font-weight:700}

    .center{display:flex;justify-content:center;margin-top:10px}
    button{appearance:none;border:none;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
    .btn{background:#f3f4f6;color:var(--ink)}
    .btn:hover{filter:brightness(1.03)}
    .primary{background:var(--ink);color:#fff}
    .danger{background:var(--danger);color:#fff}

    /* Timer */
    .timerBox{display:none;flex-direction:column;align-items:center;gap:16px;padding:12px}
    .bigSubject{font-size:34px;font-weight:900;text-align:center}
    .mode{font-weight:800;padding:6px 12px;border-radius:999px;background:#f3f4f6}
    .controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
    .next{margin-top:6px;opacity:.8}
    .doneNote{margin-top:8px;color:var(--good);font-weight:700}
    .breakNote{display:flex;align-items:center;gap:8px;margin-top:6px}
    .icon{font-size:20px}

    footer{padding:10px 16px;border-top:1px solid #e5e7eb;text-align:center;font-size:12px;color:#6b7280}

    /* Fullscreen transition overlay */
    .overlay{position:fixed;inset:0;background:rgba(255,255,255,.96);display:none;align-items:center;justify-content:center;z-index:50}
    .overlayInner{display:flex;flex-direction:column;align-items:center;gap:16px;text-align:center;padding:24px}
    .big{font-size:28px;font-weight:900}
    .sub{opacity:.8}
    .ring{width:120px;height:120px;border-radius:999px;border:6px solid var(--ink);position:relative}
    .ring::after{content:'';position:absolute;inset:-6px;border-radius:999px;border:6px solid transparent;border-top-color:var(--accent);animation:spin 1.1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .overlay .btn{background:var(--ink);color:#fff}

    /* Fullscreen timer mode */
    .timerBox.fullscreen{position:fixed;inset:0;background:#ffffff;z-index:40;display:flex;align-items:center;justify-content:center}
    .timerInner{display:flex;flex-direction:column;align-items:center;gap:16px}

    /* Circular progress timer */
    .ringWrap{position:relative;width:300px;height:300px;display:grid;place-items:center}
    .ringWrap svg{width:300px;height:300px;transform:rotate(-90deg)}
    .ringTrack{stroke:#e5e7eb;stroke-width:16;fill:none}
    .ringProg{stroke:#2563eb;stroke-width:16;fill:none;stroke-linecap:round;transition:stroke-dashoffset .3s linear}
    .time{position:absolute;font-size:72px;font-weight:900;letter-spacing:2px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="container">
        <div class="title">GCSE Daily Planner + Pomodoro</div>
        <div class="subtitle" id="dateLine">â€”</div>
      </div>
    </header>

    <main class="main">
      <div class="card">
        <p class="todayLine" id="todayLine">Today you have â€”</p>
        <p class="plan" id="plan">â€”</p>
        <ul class="list" id="subjectList"></ul>
        <div class="center"><button class="btn primary" id="beginBtn">Begin Today</button></div>

        <!-- Timer (hidden until start) -->
        <div class="timerBox" id="timerBox">
          <div class="timerInner">
            <div class="bigSubject" id="what">Revise: â€”</div>
            <div class="mode" id="mode">READY</div>
            <div class="ringWrap">
              <svg viewBox="0 0 220 220">
                <circle class="ringTrack" cx="110" cy="110" r="100" />
                <circle class="ringProg" id="ring" cx="110" cy="110" r="100" />
              </svg>
              <div class="time" id="time">00:00</div>
            </div>
            <div class="controls">
              <button class="btn" id="pauseBtn">Pause</button>
              <button class="btn" id="resumeBtn" style="display:none">Resume</button>
              <button class="btn danger" id="resetBtn">Reset</button>
            </div>
            <div class="next" id="nextText"></div>
            <div class="breakNote" id="breakNote" style="display:none"><span class="icon">â˜•</span><span>Break time â€” chill for a bit.</span></div>
            <div class="doneNote" id="doneNote" style="display:none">ðŸŽ‰ All done for today â€” nice work!</div>
          </div>
        </div>
      </div>
    </main>

    <!-- Transition Overlay (preâ€‘start & endâ€‘ofâ€‘segment) -->
    <div class="overlay" id="overlay">
      <canvas id="confetti" width="10" height="10" style="position:absolute;inset:0;width:100%;height:100%;pointer-events:none"></canvas>
      <div class="overlayInner">
        <div class="big" id="overlayTitle">Ready to start?</div>
        <div class="sub" id="overlaySub">Press Continue to begin</div>
        <button class="btn" id="continueBtn">Continue</button>
      </div>
    
    </div>

    <footer>White theme â€¢ No autoâ€‘advance â€¢ Fridays off â€¢ Saturdays = papers â€¢ Sundays = light</footer>
  </div>

  <!-- Beep sound -->
  <audio id="beep" preload="auto"></audio>

  <script>
    // =============================
    // CONFIG (edit variables here)
    // =============================
    // If you want to test a specific date, set OVERRIDE_DATE to 'YYYY-MM-DD'. Leave null to auto-use today.
    const OVERRIDE_DATE = null; // e.g. '2025-10-31'

    // Work block and break lengths in SECONDS (offâ€‘screen variables as requested)
    const WORK_BLOCK_SECONDS = 30 * 60;  // 30 minutes focused work
    const BREAK_SECONDS      = 5  * 60;  // 5 minutes short break

    // Optional: sound for stage completions (MP3 URL)
    const SOUND_URL        = 'https://mas0ng.com/revise/assets/sound/alarm-sound.mp3'; // <-- replace with your MP3 URL

    // Weekly schedule (0=Sun..6=Sat). Each item is a TOTAL time for that subject.
    const SCHEDULE = {
      1: [ // Monday
        { subject: 'Maths',     total: 30 * 60 },
        { subject: 'Chemistry', total: 60 * 60 }, // autoâ€‘split into 2Ã—30m with a break
      ],
      2: [ // Tuesday
        { subject: 'Biology',   total: 60 * 60 },
        { subject: 'Geography', total: 60 * 60 },
      ],
      3: [ // Wednesday
        { subject: 'Computer Science',    total: 60 * 60 },
        { subject: 'Design & Technology', total: 60 * 60 },
      ],
      4: [ // Thursday
        { subject: 'Physics',              total: 60 * 60 },
        { subject: 'English (Lang/Lit)',   total: 60 * 60 },
      ],
      5: [ // Friday â€” off
      ],
      6: [ // Saturday â€” Past papers / weak topics (big block)
        { subject: 'Past Papers / Weak Topics', total: 2 * 60 * 60 },
      ],
      0: [ // Sunday â€” Light review
        { subject: 'Light Review / Flashcards', total: 45 * 60 },
      ],
    };

    // =============================
    // STATE
    // =============================
    const state = {
      timeline: [],      // sequence: {type:'work'|'break', subject, seconds}
      idx: 0,
      remaining: 0,
      running: false,
      timer: null,
      effectiveDate: null,
      overlayMode: 'idle', // 'idle' | 'prestart' | 'post'
      currentTotal: 0
    };

    // =============================
    // HELPERS
    // =============================
    const pad = n => String(n).padStart(2,'0');
    const fmt = sec => `${pad(Math.floor(sec/60))}:${pad(sec%60)}`;

    function getEffectiveDate(){
      if(OVERRIDE_DATE){
        const d = new Date(OVERRIDE_DATE + 'T00:00:00');
        if(!isNaN(d)) return d;
      }
      return new Date();
    }

    function toMinutes(s){ return Math.round(s/60); }

    function buildTimelineForDay(dow){
      const plan = SCHEDULE[dow] || [];
      const timeline = [];
      plan.forEach((item, i)=>{
        const blocks = Math.ceil(item.total / WORK_BLOCK_SECONDS);
        for(let b=0;b<blocks;b++){
          const workLen = Math.min(WORK_BLOCK_SECONDS, item.total - b*WORK_BLOCK_SECONDS);
          timeline.push({ type:'work', subject:item.subject, seconds:workLen });
          // Add a break after each work block except after the last block of the whole day
          const isLastBlockOfSubject = (b === blocks-1);
          const isLastSubject = (i === plan.length-1);
          if(!(isLastBlockOfSubject && isLastSubject)){
            timeline.push({ type:'break', subject:'Break', seconds:BREAK_SECONDS });
          }
        }
      });
      return timeline;
    }

    // =============================
    // UI ELEMENTS
    // =============================
    const dateLine   = document.getElementById('dateLine');
    const todayLine  = document.getElementById('todayLine');
    const planEl     = document.getElementById('plan');
    const subjectList= document.getElementById('subjectList');
    const timerBox   = document.getElementById('timerBox');

    const modeEl = document.getElementById('mode');
    const timeEl = document.getElementById('time');
    const nextEl = document.getElementById('nextText');
    const breakNote = document.getElementById('breakNote');
    const doneNote = document.getElementById('doneNote');
    const whatEl = document.getElementById('what');

    const beginBtn = document.getElementById('beginBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const resumeBtn = document.getElementById('resumeBtn');
    const resetBtn = document.getElementById('resetBtn');

    const overlay = document.getElementById('overlay');
    const overlayTitle = document.getElementById('overlayTitle');
    const overlaySub = document.getElementById('overlaySub');
    const continueBtn = document.getElementById('continueBtn');
    const confettiCanvas = document.getElementById('confetti');
    const ctx = confettiCanvas.getContext('2d');
    const beep = document.getElementById('beep');
    if (typeof SOUND_URL === 'string' && SOUND_URL) { try { beep.src = SOUND_URL; } catch(_){} }

    const ring = document.getElementById('ring');
    const RADIUS = 100; 
    const CIRC = 2 * Math.PI * RADIUS; 
    ring.style.strokeDasharray = CIRC; 
    ring.style.strokeDashoffset = CIRC;

    // =============================
    // RENDER HELPERS
    // =============================
    function renderHeader(d){
      const days = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
      const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
      dateLine.textContent = `${days[d.getDay()]}, ${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()}`;

      const todays = SCHEDULE[d.getDay()]||[];
      if(todays.length){
        todayLine.textContent = `Today you have ${todays.map(x=>x.subject).join(' and ')}.`;
        subjectList.innerHTML = '';
        todays.forEach(item=>{
          const li = document.createElement('li');
          li.className = 'pill';
          li.textContent = `${item.subject} â€” ${toMinutes(item.total)}m`;
          subjectList.appendChild(li);
        });
        planEl.textContent = 'Press â€œBegin Todayâ€ to start';
      } else {
        todayLine.textContent = 'No scheduled subjects today.';
        planEl.textContent = 'Enjoy your day off or do a light review if you want.';
        subjectList.innerHTML='';
      }
    }

    function setMode(m){
      modeEl.textContent = m === 'work' ? 'WORK' : (m === 'break' ? 'BREAK' : 'READY');
      breakNote.style.display = (m === 'break') ? 'flex' : 'none';
    }

    function loadCurrent(){
      const step = state.timeline[state.idx];
      if(!step){
        setMode('ready');
        whatEl.textContent = 'Revise: â€”';
        timeEl.textContent = '00:00';
        ring.style.strokeDashoffset = CIRC;
        doneNote.style.display = 'block';
        nextEl.textContent = '';
        return;
      }
      doneNote.style.display = 'none';
      whatEl.textContent = step.type==='work' ? `Revise: ${step.subject}` : 'â˜• Break';
      setMode(step.type);
      state.remaining = step.seconds;
      state.currentTotal = step.seconds;
      timeEl.textContent = fmt(state.remaining);
      updateProgress();

      const nxt = state.timeline[state.idx+1];
      if(nxt){
        nextEl.textContent = (nxt.type==='work') ? `Then: ${nxt.subject} â€” ${fmt(nxt.seconds)}` : `Then: Break â€” ${fmt(nxt.seconds)}`;
      } else {
        nextEl.textContent = 'Finish strong â€” last segment!';
      }
    }

    // =============================
    // TIMER
    // =============================
    function updateProgress(){
      if(state.currentTotal>0){
        const progress = 1 - (state.remaining / state.currentTotal); // 0 -> 1
        const clamped = Math.max(0, Math.min(1, progress));
        ring.style.strokeDashoffset = CIRC * clamped;
      } else {
        ring.style.strokeDashoffset = CIRC;
      }
    }

    function lastWorkSubjectBefore(index){
      for(let i=index-1;i>=0;i--){ if(state.timeline[i].type==='work') return state.timeline[i].subject; }
      return null;
    }
    function nextWorkSubjectAfter(index){
      for(let i=index+1;i<state.timeline.length;i++){ if(state.timeline[i].type==='work') return state.timeline[i].subject; }
      return null;
    }
    function tick(){
      if(state.remaining <= 0){
        clearInterval(state.timer); state.running=false;
        try{ beep.currentTime=0; beep.play().catch(()=>{});}catch(e){}
        const finished = state.timeline[state.idx];
        if(finished){
          if(finished.type==='work'){
            overlayTitle.textContent = `Nice! ${finished.subject} block complete`;
            overlaySub.textContent = 'Press Continue to start your break';
          } else {
            const prevSub = lastWorkSubjectBefore(state.idx);
            const nextSub = nextWorkSubjectAfter(state.idx);
            if(nextSub){
              if(prevSub && nextSub !== prevSub){
                overlayTitle.textContent = `Get ready to switch to: ${nextSub}`;
              } else {
                overlayTitle.textContent = `Get ready to continue: ${nextSub}`;
              }
              overlaySub.textContent = 'Press Continue to start';
            } else {
              overlayTitle.textContent = 'Break finished';
              overlaySub.textContent = 'Press Continue';
            }
          }
        } else {
          overlayTitle.textContent = 'All done';
          overlaySub.textContent = 'Press Continue';
        }
        state.overlayMode = 'post';
        overlay.style.display = 'flex';
        startConfetti();
        return;
      }
      state.remaining--; 
      timeEl.textContent = fmt(state.remaining);
      updateProgress();
    }

    function start(){
      if(state.running) return;
      if(!state.timeline.length || state.idx>=state.timeline.length){
        return; // timeline created when pressing Begin Today
      }
      state.running = true;
      state.timer = setInterval(tick, 1000);
    }

    function pause(){ if(!state.running) return; clearInterval(state.timer); state.running=false; }

    function reset(){
      clearInterval(state.timer); state.running=false; state.idx=0; state.timeline=[];
      timerBox.style.display='none';
      whatEl.textContent='Revise: â€”'; timeEl.textContent='00:00'; nextEl.textContent=''; doneNote.style.display='none';
      overlay.style.display='none'; state.overlayMode='idle';
      renderHeader(state.effectiveDate || getEffectiveDate());
    }

    // =============================
    // EVENT BINDINGS
    // =============================
    beginBtn.addEventListener('click', ()=>{
      state.effectiveDate = getEffectiveDate();
      state.timeline = buildTimelineForDay(state.effectiveDate.getDay());
      state.idx = 0;
      if(!state.timeline.length){ return; }
      loadCurrent();
      overlayTitle.textContent = `You will first revise: ${state.timeline[0].subject}`;
      overlaySub.textContent = 'Are you ready to start?';
      state.overlayMode = 'prestart';
      overlay.style.display = 'flex';
      // hide begin button now
      beginBtn.style.display = 'none';
    });

    continueBtn.addEventListener('click', ()=>{
      overlay.style.display = 'none';
      if(state.overlayMode==='prestart'){
        timerBox.style.display='flex';
        timerBox.classList.add('fullscreen');
        start();
        state.overlayMode='idle';
        return;
      }
      if(state.overlayMode==='post'){
        // advance to next segment and start
        state.idx++;
        if(state.idx < state.timeline.length){
          loadCurrent();
          start();
        } else {
          loadCurrent();
        }
        state.overlayMode='idle';
      }
    });

    pauseBtn.addEventListener('click', function(){ pause(); pauseBtn.style.display='none'; resumeBtn.style.display='inline-block'; });
    resumeBtn.addEventListener('click', function(){ start(); resumeBtn.style.display='none'; pauseBtn.style.display='inline-block'; });
    resetBtn.addEventListener('click', reset);

    // =============================
    // CONFETTI ANIMATION (simple canvas)
    let confettiId = null; let pieces = [];
    function startConfetti(){
      resizeConfetti();
      pieces = Array.from({length:180}, function(){ return newPiece(); });
      if(confettiId) cancelAnimationFrame(confettiId);
      confettiId = requestAnimationFrame(stepConfetti);
    }
    function stopConfetti(){ if(confettiId) cancelAnimationFrame(confettiId); confettiId=null; pieces=[]; clearConfetti(); }
    function clearConfetti(){ ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height); }
    function newPiece(){
      var w = confettiCanvas.width, h = confettiCanvas.height;
      var colors = ['#2563eb','#16a34a','#f59e0b','#ef4444','#a855f7','#06b6d4'];
      return {
        x: Math.random()*w,
        y: -20 - Math.random()*h*0.3,
        r: 2 + Math.random()*4,
        vx: -1 + Math.random()*2,
        vy: 2 + Math.random()*2,
        rot: Math.random()*Math.PI,
        vr: (-0.2 + Math.random()*0.4),
        color: colors[(Math.random()*colors.length)|0],
        alpha: 0.9
      };
    }
    function stepConfetti(){
      var w = confettiCanvas.width, h = confettiCanvas.height;
      ctx.clearRect(0,0,w,h);
      for(var i=0;i<pieces.length;i++){
        var p = pieces[i];
        p.x += p.vx; p.y += p.vy; p.rot += p.vr; p.vy += 0.02; // gravity
        if(p.y>h+10){ var np = newPiece(); np.y = -10; pieces[i] = np; continue; }
        ctx.save();
        ctx.translate(p.x,p.y); ctx.rotate(p.rot);
        ctx.globalAlpha = p.alpha;
        ctx.fillStyle = p.color;
        ctx.fillRect(-p.r, -p.r, p.r*2, p.r*2);
        ctx.restore();
      }
      confettiId = requestAnimationFrame(stepConfetti);
    }
    function resizeConfetti(){ confettiCanvas.width = confettiCanvas.clientWidth; confettiCanvas.height = confettiCanvas.clientHeight; }
    window.addEventListener('resize', function(){ if(confettiId) resizeConfetti(); });

    // =============================
    // INIT AUDIO
    if (beep && !beep.src && typeof SOUND_URL === 'string' && SOUND_URL) { try { beep.src = SOUND_URL; } catch(_){} }

    // =============================
    // BOOT
    // =============================
    (function init(){
      state.effectiveDate = getEffectiveDate();
      renderHeader(state.effectiveDate);
    })();

    // =============================
    // DEV SELF-TESTS (console only, non-blocking)
    // =============================
    (function selfTests(){
      try{
        // Test 1: Monday timeline shape (Maths 30m + Chem 60m -> 1 work + break + 2 work + break)
        const monPlan = [{subject:'Maths', total:1800},{subject:'Chemistry', total:3600}];
        const orig = SCHEDULE[1];
        SCHEDULE[1] = monPlan;
        const seq = buildTimelineForDay(1);
        console.assert(seq.length === 5, 'Expected 5 steps (W,B,W,B,W) on Monday');
        console.assert(seq[0].type==='work' && seq[0].seconds===1800, 'First step should be Maths 30m');
        console.assert(seq[1].type==='break', 'Second step should be break');
        console.assert(seq[2].type==='work' && seq[2].seconds===1800, 'Third step should be Chem 30m');
        console.assert(seq[4].type==='work', 'Last step should be Chem 30m');
        SCHEDULE[1] = orig; // restore

        // Test 2: Progress math clamps 0..1
        state.currentTotal = 100; state.remaining = 100; updateProgress();
        state.remaining = 50; updateProgress();
        state.remaining = 0; updateProgress();
        console.assert(typeof ring.style.strokeDashoffset === 'string', 'Ring offset is string');
      } catch(e){ console.warn('Self-tests warning:', e); }
    })();
  </script>
</body>
</html>
